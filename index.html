<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Escolha sua cor</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f7fafc; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
    .container { width: 380px; background: white; border-radius: 12px; padding: 20px; box-shadow: 0 6px 20px rgba(0,0,0,0.1); }
    h2 { margin: 0 0 15px; font-size: 20px; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, select, button { width: 100%; padding: 10px; margin-top: 6px; border-radius: 8px; border: 1px solid #ccc; font-size: 14px; }
    button { background: #2d9cdb; color: white; border: none; font-weight: bold; cursor: pointer; margin-top: 15px; }
    .mensagem { margin-top: 10px; font-weight: bold; }
    .sucesso { color: green; }
    .erro { color: red; }
    .ocupadas { margin-top: 15px; font-size: 14px; }
    .linha { display: flex; align-items: center; gap: 8px; margin-top: 5px; }
    .swatch { width: 18px; height: 18px; border-radius: 4px; border: 1px solid #ccc; flex-shrink: 0; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Escolha sua cor</h2>

    <label for="nome">Nome</label>
    <input id="nome" type="text" placeholder="Digite seu nome" />

    <label for="cor">Cor</label>
    <select id="cor"><option value="">-- Escolha uma cor --</option></select>

    <button id="salvar" type="button">Salvar</button>
    <div id="mensagem" class="mensagem"></div>

    <div class="ocupadas">
      <strong>Cores ocupadas:</strong>
      <div id="lista-ocupadas"></div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-analytics.js";
    import { getDatabase, ref, onValue, child, get, set } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    // ðŸ”¥ Seu Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDS3Bn4X_ZktQG-jRLu4x58ubGlL16-zJc",
      authDomain: "bday-9da8b.firebaseapp.com",
      databaseURL: "https://bday-9da8b-default-rtdb.firebaseio.com",
      projectId: "bday-9da8b",
      storageBucket: "bday-9da8b.firebasestorage.app",
      messagingSenderId: "713551457375",
      appId: "1:713551457375:web:d76f0e404c33eeeeb6ffea",
      measurementId: "G-C6D3W2662E"
    };

    // Inicializa Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getDatabase(app);

    // Lista de 13 cores
    const CORES = [
      { id: "vermelho",    label: "Vermelho",    hex: "#e74c3c" },
      { id: "azul",        label: "Azul",        hex: "#3498db" },
      { id: "verde",       label: "Verde",       hex: "#2ecc71" },
      { id: "amarelo",     label: "Amarelo",     hex: "#f1c40f" },
      { id: "roxo",        label: "Roxo",        hex: "#9b59b6" },
      { id: "laranja",     label: "Laranja",     hex: "#e67e22" },
      { id: "rosa",        label: "Rosa",        hex: "#fd79a8" },
      { id: "marrom",      label: "Marrom",      hex: "#8e5c42" },
      { id: "cinza",       label: "Cinza",       hex: "#7f8c8d" },
      { id: "preto",       label: "Preto",       hex: "#2c3e50" },
      { id: "branco",      label: "Branco",      hex: "#ecf0f1" },
      { id: "verde-escuro", label: "Verde escuro", hex: "#006400" },
      { id: "azul-escuro",  label: "Azul escuro",  hex: "#00008B" }
    ];

    const selectCor = document.getElementById("cor");
    const btnSalvar = document.getElementById("salvar");
    const nomeInput = document.getElementById("nome");
    const mensagem = document.getElementById("mensagem");
    const listaOcupadas = document.getElementById("lista-ocupadas");

    function renderOptions(ocupadas) {
      selectCor.innerHTML = '<option value="">-- Escolha uma cor --</option>';
      CORES.forEach(c => {
        const opt = document.createElement("option");
        opt.value = c.id;
        opt.textContent = c.label + (ocupadas[c.id] ? " (IndisponÃ­vel)" : "");
        if (ocupadas[c.id]) opt.disabled = true;
        selectCor.appendChild(opt);
      });
    }

    function renderOcupadasList(ocupadas) {
      listaOcupadas.innerHTML = "";
      const keys = Object.keys(ocupadas);
      if (!keys.length) {
        listaOcupadas.textContent = "Nenhuma ainda.";
        return;
      }
      keys.forEach(k => {
        const info = CORES.find(c => c.id === k);
        const linha = document.createElement("div");
        linha.className = "linha";
        const sw = document.createElement("div");
        sw.className = "swatch";
        sw.style.background = info ? info.hex : "#ccc";
        const txt = document.createElement("div");
        txt.textContent = (info ? info.label : k) + " - " + ocupadas[k];
        linha.appendChild(sw);
        linha.appendChild(txt);
        listaOcupadas.appendChild(linha);
      });
    }

    // ðŸ”„ Atualiza em tempo real
    const ocupadasRef = ref(db, "coresOcupadas");
    onValue(ocupadasRef, snapshot => {
      const ocupadas = snapshot.val() || {};
      renderOptions(ocupadas);
      renderOcupadasList(ocupadas);
    });

    // Clique salvar
    btnSalvar.addEventListener("click", async () => {
      const nome = nomeInput.value.trim();
      const cor = selectCor.value;

      mensagem.className = "mensagem";
      if (!nome) {
        mensagem.textContent = "Digite seu nome.";
        mensagem.classList.add("erro");
        return;
      }
      if (!cor) {
        mensagem.textContent = "Escolha uma cor.";
        mensagem.classList.add("erro");
        return;
      }

      const snapshot = await get(child(ref(db), "coresOcupadas/" + cor));
      if (snapshot.exists()) {
        mensagem.textContent = "Essa cor jÃ¡ estÃ¡ ocupada!";
        mensagem.classList.add("erro");
      } else {
        await set(ref(db, "coresOcupadas/" + cor), nome);
        mensagem.textContent = "Cor salva com sucesso!";
        mensagem.classList.add("sucesso");
        nomeInput.value = "";
        selectCor.value = "";
      }
    });
  </script>
</body>
</html>